version: "3.1"

intents:
  - greet
  - goodbye
  - affirm
  - deny
  - mood_great
  - mood_unhappy
  - bot_challenge
  - start
  - end
  - dayoff
  - help
  - call
  - nameself

responses:
  utter_greet:
  - text: "Hey {name}! How are you?"
    condition:
    - type: slot
      name: isNewUser
      value: false
  - text: "Welcome! What is your name?"
    condition:
    - type: slot
      name: isNewUser
      value: true

  utter_cheer_up:
  - text: "Here is something to cheer you up:"
    image: "https://i.imgur.com/nGF1K8f.jpg"

  utter_happy:
  - text: "Great, carry on!"

  utter_goodbye:
  - text: "Bye"

  utter_iamabot:
  - text: "I am a bot, powered by Rasa."

  utter_help:
  - text: "Try STARTCAL, ENDCAL, or DAYOFF. If you want to speak with someone, try CALL."

  utter_success: # When STARTCAL is received between 9-11 hours after ENDCAL
  - text: "Good show! Your overall success rate is now {kdr}%!"
  - text: "Perfect! Your overall success rate is now {kdr}%!"
  - text: "Smashing! Your overall success rate is now {kdr}%!"
  - text: "Bravo, {name}! Your overall success rate is now {kdr}%!"
  - text: "Jolly good show! Your overall success rate is now {kdr}%!"
  - text: "Superb! Your overall success rate is now {kdr}%!"
  - text: "Great! Your overall success rate is now {kdr}%!"

  utter_acknowledge: # Acknowledgement sent in response to ENDCAL
  - text: "Thanks! You are now running calorie free!"
  - text: "Thanks for your response. You can do it!"
  - text: "Thanks, {name}! Here we go! Make sure your kitchen is in lock down!"
  - text: "Message received. Good luck!"
  - text: "Great. Now lock those kitchen cabinets!"
  - text: "Thanks.  You are now nibble free."
  - text: "Message received. Now stay out of the kitchen. Doctor's orders!"
  - text: "Thanks. Now go bolt the refrigerator door shut."
  - text: "Got it. Now put your tummy to sleep until the morning!"
  - text: "Muchas gracias. Now go put your feet up. You've earned it!"

  utter_idle: # No interaction in 24 hours
  - text: "We haven't heard from you in a while. Remember to text STARTCAL when your calories start in the morning and ENDCAL when your calories finish at night! Let us know if you need help."

  utter_call: # Notify study administration for personal contact
  - text: "Thanks for telling us you need more help.  One of our staff members will call you ASAP to help you get back on track."

  utter_tip: # Sent at 5pm every day
  - text: "Remember the golden rule: Once you end calories today, you need to be calorie free until tomorrow!"
  - text: "Develop a plan to help you stay calorie free overnight."
  - text: "Hide snacks to curb late night nibbles."
  - text: "If you struggle sticking with it, distract yourself with a hobby or a good book!"
  - text: "Drink fizzy water to help with the cravings."
  - text: "Alcohol is cheating!  Calorie free means alcohol free too."
  - text: "Try drinking herbal tea for a tasty way to be calorie free."
  - text: "Kiss your partner to help you stay calorie free.  It won't help you, but it will make them feel yummy!"
  - text: "Enjoy black coffee or tea with no sugar and stay calorie free. Phew!"
  - text: "Top tip: drink fizzy water from a wine glass if you are craving a glass of vino."
  - text: "{name}, is it a bummer to go calorie free? Cheer yourself up by remembering the last time you laughed so hard you almost peed in your pants."
  - text: "Try knitting to help you stay calorie free tonight. You may feel hungry but you'll get a scarf along the way!"
  - text: "Need a distraction to help you stay calorie free tonight? Do some household chores after you put your calories to bed."
  - text: "Your own mind is your greatest motivator. You CAN do this!"
  - text: "Hey TRE Queen, need a distraction? Try singing your favorite song. Now who's having the time of her life?"
  - text: "It's not just on game shows where it helps to phone a friend. Chatting with friends helps distract you AND relax at the end of the day."
  - text: "Remember to text ENDCAL when you have your last calorie tonight!"

  utter_tooearly: # When STARTCAL is received <9 hours after ENDCAL
  - text: "You ended your time-restricted eating too early. Your success rate is now {kdr}%. Try planning ahead for how you will end your TRE."
  - text: "You ended your time-restricted eating too early! {name}, your success rate is now {kdr}%. Have small snacks or meals ready so you can stay on time."
  - text: "{name} you ended your time-restricted eating too early! Your success rate is now {kdr}%. If you need help, get a family member to help you end your fasting time!"
  - text: "You ended your time-restricted eating too early. Your success rate is now {kdr}%. Try putting Post-Its on your fridge and cupboards to help you remember your target End Calories time!"

  utter_toolate: # When STARTCAL is received >11 hours after ENDCAL
  - text: "You ended your TRE too late. Your success rate is now {kdr}%. Try planning ahead for how you will end calories earlier."
  - text: "You slipped up and ended too late. Your success rate is now {kdr}%. Let's get back on track tomorrow!"
  - text: "{name} you exceeded the target eating window! Your success rate is now {kdr}%. If you need help, get a family member to help you end your calories on time!"
  - text: "You slipped up and consumed calories for too long. Your success rate is now {kdr}%. Let's get back on track tomorrow!"

  utter_after8: # When ENDCAL is received after 8pm
  - text: "You ended your time-restricted eating too late. Try to keep your calories before 8pm."
  - text: "You ended your time-restricted eating after 8pm. Try planning ahead for how you will end your daily calories earlier."
  - text: "You ended your time-restricted eating after 8pm. Try using a recurring alarm or a family member to help you end calories earlier."

  utter_weekly: # Sent once a week
  - text: "Thank you for continuing to send us your STARTCAL and ENDCAL each day. Keep up the great work!"

  utter_dayoff:
  - text: "Got it, no TRE today! Thank you for telling us. Please still let us know your STARTCAL and ENDCAL today."


slots:
  name: # User name
    type: text
    mappings:
    - type: from_text
      intent: nameself
  fasts_total:
    type: float
    initial_value: 0.0
    max_value: 999.0
    mappings:
    - type: custom
  fasts_success:
    type: float
    initial_value: 0.0
    max_value: 999.0
    mappings:
    - type: custom
  kdr: # Success rate
    type: float
    initial_value: 0.0
    max_value: 100.0
    mappings:
    - type: custom
  isNewUser:
    type: bool
    initial_value: true
    mappings:
    - type: from_intent
      value: false
      intent: nameself
  time: #holds the current time as a decimal (e.g. 8:30 = 8.5)
    type: float
    max_value: 24.0
    mappings:
    - type: custom
  usertime: #temporarily holds the last user argument from start or end commands
    type: text
    mappings:
    - type: from_entity
      entity: time
  prevtime: #holds the last time value as a decimal
    type: float
    max_value: 24.0
    initial_value: 20.0
    mappings:
    - type: custom

entities:
  - name
  - time

actions:
  - action_timeset
  - action_completefast

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
